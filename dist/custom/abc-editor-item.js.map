{
  "version": 3,
  "sources": ["../../src/custom/abc-editor-item.js"],
  "sourcesContent": ["import PropTypes from 'prop-types';\r\nimport { Form, Input } from 'antd';\r\nimport { useTranslation } from 'react-i18next';\r\nimport React, { useRef, useState } from 'react';\r\nimport AbcNotation from '../educandu-code/abc-notation.js';\r\nimport { filterAbcString, getNumberOfAbcNotes } from './utils.js';\r\nimport { FORM_ITEM_LAYOUT } from '@educandu/educandu/domain/constants.js';\r\n\r\nfunction CustomAbcNotation({ clef, initialAbc, abcRef }) {\r\n  const { t } = useTranslation('benewagner/educandu-plugin-piano');\r\n  const [abc, setAbc] = useState(initialAbc);\r\n  abcRef.current = setAbc;\r\n\r\n  return (\r\n    <Form.Item label={t('preview')} {...FORM_ITEM_LAYOUT}>\r\n      <AbcNotation abcCode={`L:1/4 \\n K:C ${clef} \\n ${abc}`} />\r\n    </Form.Item>\r\n  );\r\n}\r\n\r\n// Abc preview is child so that preview can rerender without Input losing focus\r\nexport default function AbcEditorItem(props) {\r\n  const {\r\n    index,\r\n    testIndex,\r\n    noteSequence,\r\n    handleAbcCodeChanged\r\n  } = props;\r\n\r\n  const { abc } = noteSequence;\r\n  const { clef } = noteSequence;\r\n\r\n  const [initialAbc, setInitialAbc] = useState(abc);\r\n\r\n  const abcRef = useRef(null);\r\n  const inputRef = useRef(null);\r\n  const prevInputValueRef = useRef(abc);\r\n\r\n  const { t } = useTranslation('benewagner/educandu-plugin-piano');\r\n\r\n  const handleCurrentAbcCodeChanged = event => {\r\n    const value = event.target.value;\r\n    const newAbc = filterAbcString(value);\r\n    const prevInputValue = prevInputValueRef.current;\r\n    const numberOfInputNotes = getNumberOfAbcNotes(newAbc);\r\n    if (numberOfInputNotes <= 10) {\r\n      // Update state in child to update preview\r\n      abcRef.current(newAbc);\r\n      prevInputValueRef.current = value;\r\n    } else {\r\n      setInitialAbc(prevInputValue);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <CustomAbcNotation initialAbc={abc} clef={clef} abcRef={abcRef} />\r\n      <Form.Item label={t('abcCode')} {...FORM_ITEM_LAYOUT}>\r\n        <Input\r\n          allowClear\r\n          ref={inputRef}\r\n          defaultValue={initialAbc}\r\n          onChange={handleCurrentAbcCodeChanged}\r\n          onBlur={() => handleAbcCodeChanged(prevInputValueRef.current, testIndex, index)}\r\n          />\r\n      </Form.Item>\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nCustomAbcNotation.propTypes = {\r\n  abcRef: PropTypes.object.isRequired,\r\n  clef: PropTypes.string.isRequired,\r\n  initialAbc: PropTypes.string.isRequired\r\n};\r\n\r\nAbcEditorItem.propTypes = {\r\n  noteSequence: PropTypes.object.isRequired,\r\n  handleAbcCodeChanged: PropTypes.func.isRequired,\r\n  index: PropTypes.number.isRequired,\r\n  testIndex: PropTypes.number.isRequired\r\n};\r\n\r\n"],
  "mappings": "AAAA,OAAO,eAAe;AACtB,SAAS,MAAM,aAAa;AAC5B,SAAS,sBAAsB;AAC/B,OAAO,SAAS,QAAQ,gBAAgB;AACxC,OAAO,iBAAiB;AACxB,SAAS,iBAAiB,2BAA2B;AACrD,SAAS,wBAAwB;AAEjC,SAAS,kBAAkB,EAAE,MAAM,YAAY,OAAO,GAAG;AACvD,QAAM,EAAE,EAAE,IAAI,eAAe,kCAAkC;AAC/D,QAAM,CAAC,KAAK,MAAM,IAAI,SAAS,UAAU;AACzC,SAAO,UAAU;AAEjB,SACE,oCAAC,KAAK,MAAL,EAAU,OAAO,EAAE,SAAS,GAAI,GAAG,oBAClC,oCAAC,eAAY,SAAS;AAAA,OAAgB;AAAA,GAAW,OAAO,CAC1D;AAEJ;AAGe,SAAR,cAA+B,OAAO;AAC3C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAI;AAEJ,QAAM,EAAE,IAAI,IAAI;AAChB,QAAM,EAAE,KAAK,IAAI;AAEjB,QAAM,CAAC,YAAY,aAAa,IAAI,SAAS,GAAG;AAEhD,QAAM,SAAS,OAAO,IAAI;AAC1B,QAAM,WAAW,OAAO,IAAI;AAC5B,QAAM,oBAAoB,OAAO,GAAG;AAEpC,QAAM,EAAE,EAAE,IAAI,eAAe,kCAAkC;AAE/D,QAAM,8BAA8B,WAAS;AAC3C,UAAM,QAAQ,MAAM,OAAO;AAC3B,UAAM,SAAS,gBAAgB,KAAK;AACpC,UAAM,iBAAiB,kBAAkB;AACzC,UAAM,qBAAqB,oBAAoB,MAAM;AACrD,QAAI,sBAAsB,IAAI;AAE5B,aAAO,QAAQ,MAAM;AACrB,wBAAkB,UAAU;AAAA,IAC9B,OAAO;AACL,oBAAc,cAAc;AAAA,IAC9B;AAAA,EACF;AAEA,SACE,oCAAC,MAAM,UAAN,MACC,oCAAC,qBAAkB,YAAY,KAAK,MAAY,QAAgB,GAChE,oCAAC,KAAK,MAAL,EAAU,OAAO,EAAE,SAAS,GAAI,GAAG,oBAClC;AAAA,IAAC;AAAA;AAAA,MACC,YAAU;AAAA,MACV,KAAK;AAAA,MACL,cAAc;AAAA,MACd,UAAU;AAAA,MACV,QAAQ,MAAM,qBAAqB,kBAAkB,SAAS,WAAW,KAAK;AAAA;AAAA,EAC9E,CACJ,CACF;AAEJ;AAEA,kBAAkB,YAAY;AAAA,EAC5B,QAAQ,UAAU,OAAO;AAAA,EACzB,MAAM,UAAU,OAAO;AAAA,EACvB,YAAY,UAAU,OAAO;AAC/B;AAEA,cAAc,YAAY;AAAA,EACxB,cAAc,UAAU,OAAO;AAAA,EAC/B,sBAAsB,UAAU,KAAK;AAAA,EACrC,OAAO,UAAU,OAAO;AAAA,EACxB,WAAW,UAAU,OAAO;AAC9B;",
  "names": []
}
